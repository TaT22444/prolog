<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プロログ - 教師支援ダッシュボード</title>
    <style>
        :root {
            --primary-turquoise: #4ECDC4;
            --primary-cyan: #45B7D1;
            --primary-light: #96D0CE;
            --primary-dark: #319795;
            --neutral-900: #1A202C;
            --neutral-800: #2D3748;
            --neutral-700: #4A5568;
            --neutral-600: #718096;
            --neutral-500: #A0AEC0;
            --neutral-400: #CBD5E0;
            --neutral-300: #E2E8F0;
            --neutral-200: #EDF2F7;
            --neutral-100: #F7FAFC;
            --neutral-50: #FAFBFC;
            --radius-full: 50px;
            --radius-xl: 16px;
            --radius-lg: 12px;
            --radius-md: 8px;
            --radius-sm: 6px;
            --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.03);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.03);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.04), 0 2px 4px rgba(0, 0, 0, 0.03);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.06), 0 4px 6px rgba(0, 0, 0, 0.03);
            --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.08), 0 10px 10px rgba(0, 0, 0, 0.03);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
            background-color: var(--neutral-50);
            color: var(--neutral-800);
            line-height: 1.6;
        }

        .app {
            display: flex;
            min-height: 100vh;
            background-color: var(--neutral-50);
            margin-left: 280px;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--primary-turquoise) 0%, var(--primary-cyan) 100%);
            color: white;
            padding: 20px 16px;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            min-height: 100vh;
            max-height: 100vh;
            overflow-y: auto;
            z-index: 10;
        }

        .app-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 20px;
            color: white;
            text-align: left;
            letter-spacing: -0.5px;
            line-height: 1.2;
        }

        .student-list {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.9);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding-left: 0px;
        }

        .student-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 4px;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            background: transparent;
            border: none;
        }

        .student-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .student-item.active {
            background: rgba(255, 255, 255, 0.15);
            transform: none;
            box-shadow: var(--shadow-md);
        }

        .student-avatar {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            margin-right: 10px;
            flex-shrink: 0;
            color: var(--primary-turquoise);
            box-shadow: var(--shadow-sm);
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 1px;
            color: white;
            line-height: 1.3;
        }

        .student-status {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
        }

        .nav-menu {
            flex: 1;
            margin-bottom: 16px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin-bottom: 4px;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s ease;
            color: rgba(255, 255, 255, 0.9);
            background: transparent;
            border: none;
            font-weight: 500;
            text-decoration: none;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            box-shadow: var(--shadow-md);
        }

        .nav-icon {
            font-size: 14px;
            margin-right: 10px;
            width: 18px;
            text-align: center;
        }

        .nav-text {
            font-size: 13px;
            letter-spacing: 0.2px;
        }

        .sidebar-footer {
            margin-top: auto;
            padding-top: 12px;
            flex-shrink: 0;
        }

        .profile-section {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            border: none;
            transition: all 0.2s ease;
        }

        .profile-avatar {
            width: 36px;
            height: 36px;
            border-radius: var(--radius-full);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            margin-right: 10px;
            color: var(--primary-turquoise);
            box-shadow: var(--shadow-sm);
        }

        .profile-info h4 {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 1px;
            color: white;
        }

        .profile-info p {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 400;
        }

        /* Dashboard Styles */
        .dashboard {
            flex: 1;
            background: var(--neutral-50);
            padding: 20px;
            position: relative;
        }

        .dashboard-header {
            position: sticky;
            top: 0;
            z-index: 20;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(250, 251, 252, 0.9);
            backdrop-filter: blur(20px);
            padding: 12px 0;
            margin-bottom: 20px;
        }

        .student-name-display {
            padding: 8px 16px;
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--neutral-200);
            box-shadow: var(--shadow-sm);
            font-size: 14px;
            font-weight: 600;
            color: var(--neutral-800);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .student-icon {
            width: 24px;
            height: 24px;
            background: var(--primary-turquoise);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            font-weight: 700;
        }

        .subject-selector {
            padding: 8px 16px;
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            background: white;
            font-size: 13px;
            font-weight: 500;
            color: var(--neutral-700);
            cursor: pointer;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
        }

        .subject-selector:hover {
            border-color: var(--primary-turquoise);
        }

        .dashboard-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .progress-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .grid-item {
            background: white;
            border-radius: var(--radius-xl);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--neutral-200);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .grid-item:hover {
            box-shadow: var(--shadow-md);
        }

        /* Progress Components */
        .progress-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 16px;
            gap: 12px;
            flex-shrink: 0;
        }

        .progress-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: var(--shadow-sm);
            font-size: 18px;
            color: white;
        }

        .progress-icon.praise { background: var(--primary-turquoise); }
        .progress-icon.improve { background: var(--primary-cyan); }

        .progress-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--neutral-800);
            margin-bottom: 2px;
            line-height: 1.3;
        }

        .progress-subtitle {
            font-size: 12px;
            color: var(--neutral-500);
            margin: 0;
            font-weight: 400;
            line-height: 1.4;
        }

        .progress-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .progress-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            border-radius: var(--radius-lg);
            border: none;
            transition: all 0.2s ease;
            flex-shrink: 0;
            background: var(--neutral-50);
        }

        .item-indicator {
            width: 5px;
            height: 5px;
            border-radius: var(--radius-full);
            margin-top: 7px;
            flex-shrink: 0;
        }

        .item-indicator.praise { background: var(--primary-turquoise); }
        .item-indicator.improve { background: var(--primary-cyan); }

        .item-text {
            font-size: 13px;
            line-height: 1.5;
            color: var(--neutral-700);
            font-weight: 400;
        }

        /* Assignment Flow Section */
        .assignment-flow-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--neutral-200);
        }

        .flow-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 12px;
        }

        .flow-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-lg);
            background: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .flow-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--neutral-800);
            line-height: 1.3;
        }

        .flow-timeline {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .flow-point {
            background: white;
            border: 1px solid var(--neutral-200);
            border-radius: var(--radius-lg);
            padding: 16px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-width: 120px;
            position: relative;
            box-shadow: var(--shadow-xs);
            cursor: pointer;
            transition: all 0.2s ease;
            opacity: 0.7;
        }

        .flow-point:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            opacity: 1;
        }

        .flow-point.completed {
            background: white;
            border-color: var(--primary-turquoise);
            opacity: 1;
            box-shadow: var(--shadow-sm);
        }

        .flow-point.completed::after {
            content: '✓';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 16px;
            height: 16px;
            background: var(--primary-turquoise);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
        }

        .flow-point.current {
            background: white;
            border-color: var(--primary-turquoise);
            border-width: 2px;
            box-shadow: 0 0 0 4px rgba(78, 205, 196, 0.1);
            opacity: 1;
        }

        .flow-point.current::before {
            content: '';
            position: absolute;
            top: 8px;
            right: 8px;
            width: 8px;
            height: 8px;
            background: #FFC107;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .flow-point.pending {
            background: var(--neutral-50);
            border-color: var(--neutral-300);
            opacity: 0.5;
        }

        .flow-point.selected {
            background: white;
            border-color: var(--primary-turquoise);
            border-width: 2px;
            box-shadow: 0 0 0 4px rgba(78, 205, 196, 0.15), var(--shadow-lg);
            opacity: 1;
            transform: translateY(-2px);
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        .flow-number {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 10px;
            transition: all 0.2s ease;
        }

        .flow-number.completed { 
            background: var(--primary-turquoise); 
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .flow-number.current { 
            background: var(--primary-turquoise); 
            color: white;
            box-shadow: var(--shadow-md);
            border: 2px solid white;
        }
        
        .flow-number.pending { 
            background: var(--neutral-200); 
            color: var(--neutral-500);
            border: 2px solid var(--neutral-300);
        }

        .flow-point-title {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--neutral-800);
            line-height: 1.3;
        }

        .flow-description {
            font-size: 10px;
            color: var(--neutral-500);
            font-weight: 400;
            line-height: 1.3;
        }

        /* Selected Flow Details */
        .selected-flow-details {
            background: var(--neutral-50);
            border: 2px solid var(--neutral-200);
            border-radius: var(--radius-xl);
            padding: 24px;
            transition: all 0.3s ease;
        }

        .selected-flow-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 12px;
        }

        .selected-flow-number {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: white;
            box-shadow: var(--shadow-md);
        }

        .selected-flow-number.completed { background: var(--primary-turquoise); }
        .selected-flow-number.current { background: #FFC107; }
        .selected-flow-number.pending { background: var(--neutral-400); }

        .selected-flow-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--neutral-800);
            line-height: 1.3;
        }

        .selected-flow-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 16px;
        }

        .flow-image-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .flow-image {
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: var(--radius-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 56px;
            border: 2px solid rgba(69, 183, 209, 0.1);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .flow-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
        }

        .flow-image-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            z-index: 1;
        }

        .image-caption {
            font-size: 13px;
            color: var(--neutral-600);
            text-align: left;
            font-weight: 400;
            line-height: 1.6;
            padding: 16px;
            background: white;
            border-radius: var(--radius-lg);
            border: 1px solid var(--neutral-200);
        }

        .flow-progress-section {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .progress-summary {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--neutral-200);
            box-shadow: var(--shadow-sm);
        }

        .progress-label {
            font-size: 13px;
            color: var(--neutral-600);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .progress-bar {
            height: 10px;
            background: var(--neutral-200);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-turquoise) 0%, var(--primary-cyan) 100%);
            transition: width 0.3s ease;
        }

        .progress-percentage {
            font-size: 16px;
            font-weight: 700;
            color: var(--primary-turquoise);
            text-align: center;
        }

        .progress-stats {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--neutral-200);
            box-shadow: var(--shadow-sm);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--neutral-200);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-size: 13px;
            color: var(--neutral-600);
            font-weight: 500;
        }

        .stat-value {
            font-size: 15px;
            font-weight: 700;
            color: var(--neutral-800);
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <div class="sidebar">
            <h1 class="app-title">プロログ</h1>
            
            <div class="student-list">
                <h3 class="section-title">児童一覧</h3>
                <div class="student-item active">
                    <div class="student-avatar">さ</div>
                    <div class="student-info">
                        <div class="student-name">佐藤 さとう</div>
                        <div class="student-status">順調に進行中</div>
                    </div>
                </div>
                <div class="student-item">
                    <div class="student-avatar">あ</div>
                    <div class="student-info">
                        <div class="student-name">鈴木 あお</div>
                        <div class="student-status">要注意・サポート必要</div>
                    </div>
                </div>
                <div class="student-item">
                    <div class="student-avatar">り</div>
                    <div class="student-info">
                        <div class="student-name">田中 りく</div>
                        <div class="student-status">優秀・先取り学習</div>
                    </div>
                </div>
                <div class="student-item">
                    <div class="student-avatar">み</div>
                    <div class="student-info">
                        <div class="student-name">渡辺 みお</div>
                        <div class="student-status">順調に進行中</div>
                    </div>
                </div>
            </div>
            
            <nav class="nav-menu">
                <a href="class-overview.html" class="nav-item">
                    <span class="nav-icon">📊</span>
                    <span class="nav-text">ダッシュボード</span>
                </a>
                <a href="tasks.html" class="nav-item">
                    <span class="nav-icon">📝</span>
                    <span class="nav-text">課題管理</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <div class="profile-section">
                    <div class="profile-avatar">👩‍🏫</div>
                    <div class="profile-info">
                        <h4>山田 先生</h4>
                        <p>3年2組</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="dashboard-header">
                <div class="student-name-display">
                    <div class="student-icon">さ</div>
                    <span>佐藤 さとう</span>
                </div>
                <select class="subject-selector" id="taskSelector">
                    <option value="">課題ごとに見る</option>
                </select>
            </div>
            
            <div class="dashboard-content">
                <!-- Progress Section -->
                <div class="progress-section">
                    <!-- 褒めるべきところ -->
                    <div class="grid-item">
                        <div class="progress-header">
                            <div class="progress-icon praise">👍</div>
                            <div>
                                <h3 class="progress-title">褒めるべきところ</h3>
                                <p class="progress-subtitle">プロセス重視で、児童の取り組みの成果</p>
                            </div>
                        </div>
                        <div class="progress-content">
                            <div class="progress-item praise">
                                <div class="item-indicator praise"></div>
                                <div class="item-text">問題解決の過程で、複数の解法を試行錯誤している</div>
                            </div>
                            <div class="progress-item praise">
                                <div class="item-indicator praise"></div>
                                <div class="item-text">問題解決の過程で、複数の解法を試行錯誤している</div>
                            </div>
                        </div>
                    </div>

                    <!-- 伸ばすべきところ -->
                    <div class="grid-item">
                        <div class="progress-header">
                            <div class="progress-icon improve">📈</div>
                            <div>
                                <h3 class="progress-title">伸ばすべきところ</h3>
                            </div>
                        </div>
                        <div class="progress-content">
                            <div class="progress-item improve">
                                <div class="item-indicator improve"></div>
                                <div class="item-text">計算の見直しをする習慣をつける</div>
                            </div>
                            <div class="progress-item improve">
                                <div class="item-indicator improve"></div>
                                <div class="item-text">文章題での式の立て方を練習する</div>
                            </div>
                            <div class="progress-item improve">
                                <div class="item-indicator improve"></div>
                                <div class="item-text">文章題での式の立て方を練習する</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assignment Flow Section -->
                <div class="assignment-flow-section">
                    <div class="flow-header">
                        <div class="flow-icon">🎨</div>
                        <h3 class="flow-title">図工の授業 - 「季節の風景を描こう」プロジェクト</h3>
                    </div>
                    
                    <div class="flow-timeline">
                        <div class="flow-point completed" data-flow="1">
                            <div class="flow-number completed">1</div>
                            <div class="flow-point-title">Week 1</div>
                            <div class="flow-description">観察とスケッチ</div>
                        </div>
                        <div class="flow-point completed" data-flow="2">
                            <div class="flow-number completed">2</div>
                            <div class="flow-point-title">Week 2</div>
                            <div class="flow-description">色彩の学習</div>
                        </div>
                        <div class="flow-point current selected" data-flow="3">
                            <div class="flow-number current">3</div>
                            <div class="flow-point-title">Week 3</div>
                            <div class="flow-description">下絵制作</div>
                        </div>
                        <div class="flow-point pending" data-flow="4">
                            <div class="flow-number pending">4</div>
                            <div class="flow-point-title">Week 4</div>
                            <div class="flow-description">彩色作業</div>
                        </div>
                        <div class="flow-point pending" data-flow="5">
                            <div class="flow-number pending">5</div>
                            <div class="flow-point-title">Week 5</div>
                            <div class="flow-description">仕上げ</div>
                        </div>
                        <div class="flow-point pending" data-flow="6">
                            <div class="flow-number pending">6</div>
                            <div class="flow-point-title">Week 6</div>
                            <div class="flow-description">発表・鑑賞</div>
                        </div>
                    </div>

                    <div class="selected-flow-details">
                        <div class="selected-flow-header">
                            <div class="selected-flow-number current" id="selected-number">3</div>
                            <div class="selected-flow-title" id="selected-title">Week 3 - 下絵制作</div>
                        </div>
                        <div class="selected-flow-content">
                            <div class="flow-image-section">
                                <div class="flow-image" id="selected-image">
                                    <div class="flow-image-content">✏️</div>
                                </div>
                                <div class="image-caption" id="selected-caption">佐藤さんは観察したスケッチを基に、画用紙に丁寧に下絵を描いています。構図を考えながら、細部まで気を配って制作に取り組んでいます。</div>
                            </div>
                            <div class="flow-progress-section">
                                <div class="progress-summary">
                                    <div class="progress-label">進捗度</div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="selected-progress" style="width: 70%"></div>
                                    </div>
                                    <span class="progress-percentage" id="selected-percentage">70%</span>
                                </div>
                                <div class="progress-stats" id="selected-stats">
                                    <div class="stat-item">
                                        <div class="stat-label">構図力</div>
                                        <div class="stat-value">85%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">観察力</div>
                                        <div class="stat-value">90%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-label">集中力</div>
                                        <div class="stat-value">80%</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 課題データ管理クラス
        class DashboardTaskManager {
            constructor() {
                this.tasks = this.loadTasks();
                this.currentTask = this.getCurrentTask();
                this.flowData = this.generateFlowData();
            }

            // ローカルストレージから課題を読み込み
            loadTasks() {
                const saved = localStorage.getItem('prolog_tasks');
                return saved ? JSON.parse(saved) : [];
            }

            // 現在アクティブな課題を取得
            getCurrentTask() {
                const now = new Date();
                return this.tasks.find(task => {
                    const startDate = new Date(task.startDate);
                    const endDate = new Date(task.endDate);
                    return now >= startDate && now <= endDate;
                }) || this.getDefaultTask();
            }

            // デフォルト課題（課題が作成されていない場合）
            getDefaultTask() {
                return {
                    id: 'default',
                    title: '季節の風景を描こう',
                    subject: 'art',
                    weeks: [
                        '観察とスケッチ',
                        '色彩の学習', 
                        '下絵制作',
                        '彩色作業',
                        '仕上げ',
                        '発表・鑑賞'
                    ],
                    startDate: '2024-04-01',
                    endDate: '2024-05-15'
                };
            }

            // 課題からフローデータを生成
            generateFlowData() {
                const flowData = {};
                const task = this.currentTask;
                
                const defaultImages = ['🌸', '🎨', '✏️', '🖌️', '✨', '🖼️'];
                                 const defaultCaptionTemplates = [
                     {
                         completed: '佐藤さんは校庭の桜の木を丁寧に観察し、細部まで気を配ってスケッチを完成させました。花びらの形や枝の伸び方を正確に捉えることができています。',
                         current: '佐藤さんは校庭の桜の木を丁寧に観察し、細部まで気を配ってスケッチしています。花びらの形や枝の伸び方を正確に捉えることができています。',
                         pending: 'この週では、校庭の桜の木を観察し、スケッチを描く予定です。花びらの形や枝の伸び方を正確に捉える練習をします。'
                     },
                     {
                         completed: '色の三原色や混色について学習しました。佐藤さんは実際に絵の具を混ぜて様々な色を作り出し、色彩カードを完成させました。',
                         current: '色の三原色や混色について学習しています。佐藤さんは実際に絵の具を混ぜて様々な色を作り出し、色彩カードを作成しています。',
                         pending: 'この週では、色の三原色や混色について学習する予定です。実際に絵の具を混ぜて様々な色を作り出し、色彩カードを作成します。'
                     },
                     {
                         completed: '佐藤さんは観察したスケッチを基に、画用紙に丁寧に下絵を描き上げました。構図を考えながら、細部まで気を配って制作に取り組みました。',
                         current: '佐藤さんは観察したスケッチを基に、画用紙に丁寧に下絵を描いています。構図を考えながら、細部まで気を配って制作に取り組んでいます。',
                         pending: 'この週では、観察したスケッチを基に画用紙に下絵を描く予定です。構図を考えながら、細部まで気を配って制作に取り組みます。'
                     },
                     {
                         completed: '学習した色彩知識を活用して彩色作業を完了しました。季節感を表現する色使いを意識して制作することができました。',
                         current: '学習した色彩知識を活用して彩色作業に取り組んでいます。季節感を表現する色使いを意識して制作しています。',
                         pending: 'この週では、学習した色彩知識を活用して彩色作業に取り組む予定です。季節感を表現する色使いを意識して制作します。'
                     },
                     {
                         completed: '作品の細部を調整し、全体のバランスを整えて作品を完成させました。必要な描き込みや色の調整を行い、満足のいく仕上がりになりました。',
                         current: '作品の細部を調整し、全体のバランスを整えています。必要に応じて追加の描き込みや色の調整を行っています。',
                         pending: 'この週では、作品の細部を調整し、全体のバランスを整える予定です。必要に応じて追加の描き込みや色の調整を行います。'
                     },
                     {
                         completed: '完成した作品を発表し、クラスメイトの作品を鑑賞しました。作品の良いところを見つけて感想を伝え合い、お互いの表現を認め合うことができました。',
                         current: '完成した作品を発表し、クラスメイトの作品を鑑賞しています。作品の良いところを見つけて感想を伝え合い、お互いの表現を認め合っています。',
                         pending: 'この週では、完成した作品を発表し、クラスメイトの作品を鑑賞する予定です。作品の良いところを見つけて感想を伝え合い、お互いの表現を認め合います。'
                     }
                 ];

                task.weeks.forEach((week, index) => {
                    const weekNumber = index + 1;
                    const now = new Date();
                    const startDate = new Date(task.startDate);
                    const weekStart = new Date(startDate);
                    weekStart.setDate(startDate.getDate() + (index * 7));
                    const weekEnd = new Date(weekStart);
                    weekEnd.setDate(weekStart.getDate() + 6);

                    let status, progress;
                    if (now > weekEnd) {
                        status = 'completed';
                        progress = 100;
                    } else if (now >= weekStart && now <= weekEnd) {
                        status = 'current';
                        progress = 70; // 現在の週の進捗
                    } else {
                        status = 'pending';
                        progress = 0;
                    }

                                         // 状態に応じた説明文を選択
                     const captionTemplate = defaultCaptionTemplates[index];
                     let caption;
                     if (captionTemplate) {
                         caption = captionTemplate[status] || captionTemplate.pending;
                     } else {
                         // デフォルトの説明文
                         if (status === 'completed') {
                             caption = `Week ${weekNumber}の活動を完了しました。`;
                         } else if (status === 'current') {
                             caption = `Week ${weekNumber}の活動に取り組んでいます。`;
                         } else {
                             caption = `Week ${weekNumber}の活動を行う予定です。`;
                         }
                     }

                     flowData[weekNumber] = {
                         title: `Week ${weekNumber} - ${week}`,
                         image: defaultImages[index] || '📝',
                         caption: caption,
                         progress: progress,
                         status: status,
                         stats: this.generateWeekStats(status)
                     };
                });

                return flowData;
            }

            // 週の統計データを生成
            generateWeekStats(status) {
                if (status === 'completed') {
                    return [
                        { label: "理解度", value: "95%" },
                        { label: "技能", value: "90%" },
                        { label: "意欲", value: "100%" }
                    ];
                } else if (status === 'current') {
                    return [
                        { label: "構図力", value: "85%" },
                        { label: "観察力", value: "90%" },
                        { label: "集中力", value: "80%" }
                    ];
                } else {
                    return [
                        { label: "準備度", value: "0%" },
                        { label: "理解度", value: "0%" },
                        { label: "意欲", value: "0%" }
                    ];
                }
            }

                         // フロー表示を更新
             updateFlowDisplay() {
                 const task = this.currentTask;
                 
                 // 課題セレクターを更新
                 this.updateTaskSelector();
                 
                 // タイトルを更新
                 const flowTitle = document.querySelector('.flow-title');
                 if (flowTitle) {
                     const subjectNames = {
                         'art': '図工',
                         'japanese': '国語',
                         'math': '算数',
                         'science': '理科',
                         'social': '社会'
                     };
                     flowTitle.textContent = `${subjectNames[task.subject] || '図工'}の授業 - 「${task.title}」プロジェクト`;
                 }

                 // フローポイントを更新
                 const timeline = document.querySelector('.flow-timeline');
                 if (timeline) {
                     timeline.innerHTML = '';
                     
                     task.weeks.forEach((week, index) => {
                         const weekNumber = index + 1;
                         const data = this.flowData[weekNumber];
                         
                         const flowPoint = document.createElement('div');
                         flowPoint.className = `flow-point ${data.status}`;
                         if (data.status === 'current') {
                             flowPoint.classList.add('selected');
                         }
                         flowPoint.setAttribute('data-flow', weekNumber);
                         
                         flowPoint.innerHTML = `
                             <div class="flow-number ${data.status}">${weekNumber}</div>
                             <div class="flow-point-title">Week ${weekNumber}</div>
                             <div class="flow-description">${week}</div>
                         `;
                         
                         // クリックイベントリスナーを追加
                         flowPoint.addEventListener('click', function() {
                             selectFlow(weekNumber);
                         });
                         
                         timeline.appendChild(flowPoint);
                     });
                 }

                 // 現在の週を選択状態にする
                 const currentWeek = Object.keys(this.flowData).find(key => 
                     this.flowData[key].status === 'current'
                 ) || '1';
                 
                 setTimeout(() => {
                     selectFlow(currentWeek);
                 }, 100);
             }

             // 課題セレクターを更新
             updateTaskSelector() {
                 const selector = document.getElementById('taskSelector');
                 if (!selector) return;

                 const subjectNames = {
                     'art': '図工',
                     'japanese': '国語',
                     'math': '算数',
                     'science': '理科',
                     'social': '社会'
                 };

                 // 既存のオプションをクリア（最初のオプションは残す）
                 selector.innerHTML = '<option value="">課題ごとに見る</option>';

                 // 課題を追加
                 this.tasks.forEach(task => {
                     const option = document.createElement('option');
                     option.value = task.id;
                     option.textContent = `${subjectNames[task.subject] || task.subject} - ${task.title}`;
                     if (task.id === this.currentTask.id) {
                         option.selected = true;
                     }
                     selector.appendChild(option);
                 });

                 // セレクター変更時のイベントリスナー（重複を避けるため一度削除）
                 selector.removeEventListener('change', this.handleTaskChange);
                 this.handleTaskChange = (e) => {
                     if (e.target.value) {
                         this.switchTask(e.target.value);
                     }
                 };
                 selector.addEventListener('change', this.handleTaskChange);
             }

             // 課題を切り替え
             switchTask(taskId) {
                 const task = this.tasks.find(t => t.id == taskId);
                 if (task) {
                     this.currentTask = task;
                     this.flowData = this.generateFlowData();
                     this.updateFlowDisplay();
                     
                     // 現在の週を選択状態にする
                     const currentWeek = Object.keys(this.flowData).find(key => 
                         this.flowData[key].status === 'current'
                     ) || '1';
                     
                     setTimeout(() => {
                         selectFlow(currentWeek);
                     }, 100);
                 }
             }
        }

        // グローバル変数
        let dashboardTaskManager;
        let flowData = {};

        // フローポイントをクリックしたときの処理
        function selectFlow(flowNumber) {
            const data = flowData[flowNumber];
            
            // 選択状態を更新
            document.querySelectorAll('.flow-point').forEach(point => {
                point.classList.remove('selected');
            });
            document.querySelector(`[data-flow="${flowNumber}"]`).classList.add('selected');
            
            // 詳細情報を更新
            document.getElementById('selected-number').textContent = flowNumber;
            document.getElementById('selected-number').className = `selected-flow-number ${data.status}`;
            document.getElementById('selected-title').textContent = data.title;
            
            // 画像を更新
            const imageContent = document.querySelector('#selected-image .flow-image-content');
            if (imageContent) {
                imageContent.textContent = data.image;
            }
            
            document.getElementById('selected-caption').textContent = data.caption;
            document.getElementById('selected-progress').style.width = `${data.progress}%`;
            document.getElementById('selected-percentage').textContent = `${data.progress}%`;
            
            // 統計情報を更新
            const statsContainer = document.getElementById('selected-stats');
            statsContainer.innerHTML = '';
            data.stats.forEach(stat => {
                const statItem = document.createElement('div');
                statItem.className = 'stat-item';
                statItem.innerHTML = `
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-value">${stat.value}</div>
                `;
                statsContainer.appendChild(statItem);
            });
        }

        // イベントリスナーを追加
        document.addEventListener('DOMContentLoaded', function() {
            // DashboardTaskManagerを初期化
            dashboardTaskManager = new DashboardTaskManager();
            flowData = dashboardTaskManager.flowData;
            
            // フロー表示を更新
            dashboardTaskManager.updateFlowDisplay();
        });
    </script>
</body>
</html> 